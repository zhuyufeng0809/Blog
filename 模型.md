###数仓设计基本原则：
1.高内聚、低耦合  
2.核心模型、扩展模型分离  
3.公共处理逻辑下沉、单一   
避免烟囱式开发（重复建设） 
4.空间与性能平衡  
5.数据可回滚  
6.一致性  
7.命名清晰、可理解  

###基本概念：
业务过程：一个不可拆分的行为事件  

数据域：指面向**业务分析**，将业务过程和维度进行抽象的集合  

业务板块：比数据域更高维度的业务划分方法  

维度：是度量的环境，是观察业务的角度  

维度属性：维度属性的集合构成维度  

度量：即事实，通常为数值型数据  

业务限定：统计的业务范围，筛选出符合业务规则的记录（类似于SQL中where后的条件，不包括时间区间）    

修饰词：  

修饰类型：  

统计周期：统计的时间范围，例如最近一天，最近30天（类似于SQL中where后的时间条件）  

粒度：是数据的详细程度，是数据需要汇总的程度。可理解为聚合运算时的分组条件（类似于SQL中的group by的对象）。粒度是维度的一个组合，粒度常作为派生指标的修饰词而存在  

指标：指标分为原子指标和派生指标。原子指标是某一业务过程中的度量，是不可再拆分的指标，是具有明确业务含义的名词，体现明确的业务统计口径和计算逻辑，例如支付金额  

* 原子指标=业务过程+度量
* 派生指标=时间周期+修饰词+原子指标，派生指标可以理解为对原子指标业务统计范围的圈定

###业务调研与需求分析
**充分的业务调研和需求分析是数据仓库建设的基石，直接决定数据仓库能否建设成功**
####上游系统业务调研
#####分析业务过程
请相关的业务人员介绍具体的业务  

整体业务架构，各个业务板块之间的联系和信息流动的流程  

各个已有的业务板块的主要功能及获取的数据，对应一个或多个表  

* 对业务板块进行分解，了解每个业务过程会产生哪些数据，数据的内容是什么，存在于什么数据库中
* 数据在什么情况下会更新，更新的逻辑是什么 

识别维度  

确定粒度：在业务过程分析中，需要预判所有分析需要细分的程度和范围，从而确定粒度  

需要梳理出整体的业务数据框架 

#####划分数据域
数据域需要抽象提炼，并长期维护更新。数据域可以按照用户企业的部门划分，也可以按照业务过程或者业务板块中的功能模块进行划分

| 数据域 | 业务过程 |
| :----: | :----: |
|会员店铺域|注册、登录、装修、开店、关店|
|商品域|发布、上架、下架、重发|
|日志域|曝光、浏览、单击|
|交易域|下单、支付、发货、确认收货|
|服务域|商品收藏、拜访、培训、优惠券领用|
|采购域|商品采购、供应链管理|

#####定义一致性维度与构建总线矩阵
定义一致性维度：作为维度建模的核心，在企业级数据仓库中必须保证维度的唯一性，即有且只允许有一种维度定义，对于任何业务过程所传达的信息都是一致的

构建总线矩阵：明确每个数据域下有哪些业务过程后，即可构建总线矩阵。需要明确业务过程与哪些维度相关，并定义每个数据域下的业务过程和维度。

#####明确原子指标
原子指标是明确的统计口径、计算逻辑： 原子指标=业务过程+度量  

原子指标注意事项：

* 原子指标的创建需要在业务过程定义后方才可创建
* 原子指标、修饰类型及修饰词，直接归属在业务过程下，其中修饰词继承修饰类型的数据域

####下游系统需求分析
**在未考虑数据分析师和业务运营人员的数据需求的情况下，单纯根据业务调研结果构建的数据仓库可用性差**  

在需求分析阶段，需要沉淀出业务分析或报表中的指标，以及指标的定义和粒度。粒度可以作为维度的输入，需明确以下内容： 

* 根据什么（维度）汇总
* 汇总什么（度量、派生指标即常见的统计指标：派生指标=时间周期+修饰词+原子指标）
* 汇总的范围多大（粒度）
* 明细数据层和汇总数据层应该如何设计
* 公共维度层该如何设计
* 是否有公共的指标
* 数据是否需要冗余或沉淀到汇总数据层中

派生指标注意事项：

* 新建派生指标前必须新建好原子指标
* 派生指标可以选择多个修饰词，由具体的派生指标语义决定
* 派生指标唯一归属一个原子指标，继承原子指标的数据域，与修饰词的数据域无关

**需求调研的分析产出通常是记录原子与派生指标的文档**

###技术架构选型

###数仓分层


##########################
ods
表或字段命名尽量和业务系统保持一致，但是需要通过额外的标识来区分增量和全量表。例如，我们通过_delta来标识该表为增量表

命名时需要特别注意冲突处理，例如不同业务系统的表可能是同一个名称。为区分两个不同的表，您可以将这两个同名表的来源数据库名称作为后缀或前缀。例如，表中某些字段的名称刚好和关键字重名了，可以通过添加_col1后缀解决

dim
公共维度汇总层（DIM）维表命名规范：dim_{业务板块名称/pub}_{维度定义}[_{自定义命名标签}]，pub是与具体业务板块无关或各个业务板块都可公用的维度

dwd
dwd_{业务板块/pub}_{数据域缩写}_{业务过程缩写}[_{自定义表命名标签缩写}] _{单分区增量全量标识}，pub表示数据包括多个业务板块的数据。单分区增量全量标识通常为：i表示增量，f表示全量

dws
公共汇总事实表命名规范：dws_{业务板块缩写/pub}_{数据域缩写}_{数据粒度缩写}[_{自定义表命名标签缩写}]_{统计时间周期范围缩写}